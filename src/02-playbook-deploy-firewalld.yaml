---
- name: deploy FirewallD
  hosts: target1

  tasks:
  - name: intall firewall service on target server
    # exec: sudo yum install -y firewalld
    become: true
    ansible.builtin.yum:
      name: firewalld
      state: latest

  - name: start firewall service  
    # exec: sudo service firewalld start
    # exec: sudo systemctl enable firewalld
    become: true
    ansible.builtin.service:
      name: firewalld
      state: started  # start service
      enabled: yes    # enable service after reboot

  - name: populate firewalld service facts
    # exec: service firewalld status
    ansible.builtin.service_facts:

- name: configure FirewallD rules for database
  hosts: target1

  tasks:
  - name: configure firewall rules for database
    # sudo firewall-cmd --permanent --zone=public --add-port=3306/tcp
    ansible.posix.firewalld:
      port: 3306/tcp
      permanent: yes
      zone: public
      state: enable

  - name: reload firewalld service
    # sudo firewall-cmd --list-all
    # sudo firewall-cmd --reload
    # sudo firewall-cmd --list-all
    ansible.builtin.service:
      name: firewalld
      state: restarted

  - name: populate firewalld service facts
    # exec: service firewalld status
    ansible.builtin.service_facts:

- name: configure FirewallD rules for web server
  hosts: target1

  tasks:
  - name: configure firewall rules for web server
    # sudo firewall-cmd --list-all
    # sudo firewall-cmd --permanent --zone=public --add-port=80/tcp
    become: true
    ansible.posix.firewalld:
      port: 80/tcp
      permanent: yes
      zone: public
      state: enable
        
  - name: reload firewalld service
    # sudo firewall-cmd --list-all
    # sudo firewall-cmd --reload
    # sudo firewall-cmd --list-all
    ansible.builtin.service:
      name: firewalld
      state: restarted

  - name: populate firewalld service facts
    # exec: service firewalld status
    ansible.builtin.service_facts:
